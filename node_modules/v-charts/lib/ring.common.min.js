"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var constants=require('./constants'),utils=require('./utils'),utilsLite=require("utils-lite");require("echarts/lib/chart/pie");var Core=_interopDefault(require('./core')),_extends=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},pieRadius=100,ringRadius=[80,100],roseRingRadius=[20,100],pieOffsetY=200;function getPieSeries(e){var i=e.innerRows,t=e.dataType,n=e.percentShow,r=e.dimension,o=e.metrics,a=e.radius,s=e.offsetY,l=e.selectedMode,u=e.hoverAnimation,d=e.digit,c=e.roseType,m=e.label,p=e.level,f=e.limitShowNum,h=e.isRing,v=e.labelLine,g=e.itemStyle,w=[],b={},y=[];p?(p.forEach(function(e,i){e.forEach(function(e){b[e]=i})}),i.forEach(function(e){var i=b[e[r]];void 0!==i&&(y[i]?y[i].push(e):y[i]=[e])})):y.push(i);var R={type:"pie",selectedMode:l,hoverAnimation:u,roseType:c,center:["50%",s]},S=y.length;if(y.forEach(function(e,i){var s=_extends({data:[]},R),l=a/S;if(i){var u=l+a/(2*S)*(2*i-1),c=u+a/(2*S);s.radius=[u,c]}else s.radius=h?a:l;S>1&&0===i&&(s.label={normal:{position:"inner"}}),m&&(s.label=m),v&&(s.labelLine=v),g&&(s.itemStyle=g),n&&(s.label={normal:{show:!0,position:S>1&&0===i?"inner":"outside",formatter:function(e){var i=[];return i.push(e.name+":"),i.push(utils.getFormated(e.value,t,d)),i.push("("+e.percent+"%)"),i.join(" ")}}}),s.data=e.map(function(e){return{name:e[r],value:e[o]}}),w.push(s)}),f&&f<w[0].data.length){var L=w[0].data,N=0;L.slice(f,L.length).forEach(function(e){N+=e.value}),w[0].data=L.slice(0,f),w[0].data.push({name:"其他",value:N})}return w}function getPieLegend(e){var i=e.innerRows,t=e.dimension,n=e.legendLimit,r=e.legendName,o=e.level,a=e.limitShowNum,s=[],l=[];if(o)o.forEach(function(e){e.forEach(function(e){l.push(e)})}),s=l;else if(a&&a<i.length){for(var u=0;u<a;u++)s.push(i[u][t]);s.push("其他")}else s=i.map(function(e){return e[t]});return!!s.length&&{data:s,show:s.length<n,formatter:function(e){return null!=r[e]?r[e]:e}}}function getPieTooltip(e){var i=e.dataType,t=e.innerRows,n=e.limitShowNum,r=e.digit,o=e.metrics,a=e.dimension,s=0,l=t.map(function(e){return s+=e[o],{name:e[a],value:e[o]}}).slice(n,t.length);return{formatter:function(e){var t=[];return t.push(constants.itemPoint(e.color)),n&&"其他"===e.name?(t.push("其他:"),l.forEach(function(e){var n=e.name,o=e.value,a=utils.getFormated(o/s,"percent");t.push("<br>"+n+":"),t.push(utils.getFormated(o,i,r)),t.push("("+a+")")})):(t.push(e.name+":"),t.push(utils.getFormated(e.value,i,r)),t.push("("+e.percent+"%)")),t.join(" ")}}}var pie$1=function(e,i,t,n,r){var o=utilsLite.cloneDeep(i),a=t.dataType,s=void 0===a?"normal":a,l=t.percentShow,u=t.dimension,d=void 0===u?e[0]:u,c=t.metrics,m=void 0===c?e[1]:c,p=t.roseType,f=void 0!==p&&p,h=t.radius,v=void 0===h?r?f?roseRingRadius:ringRadius:pieRadius:h,g=t.offsetY,w=void 0===g?pieOffsetY:g,b=t.legendLimit,y=void 0===b?30:b,R=t.selectedMode,S=void 0!==R&&R,L=t.hoverAnimation,N=void 0===L||L,T=t.digit,E=void 0===T?2:T,P=t.legendName,x=void 0===P?{}:P,j=t.label,q=void 0!==j&&j,O=t.level,Y=void 0!==O&&O,_=t.limitShowNum,A=void 0===_?0:_,F=t.labelLine,M=t.itemStyle,D=n.tooltipVisible,V=n.legendVisible;return A&&o.sort(function(e,i){return i[m]-e[m]}),{series:getPieSeries({innerRows:o,dataType:s,percentShow:l,dimension:d,metrics:m,radius:v,offsetY:w,selectedMode:S,hoverAnimation:N,digit:E,roseType:f,label:q,level:Y,legendName:x,limitShowNum:A,isRing:r,labelLine:F,itemStyle:M}),legend:V&&getPieLegend({innerRows:o,dimension:d,legendLimit:y,legendName:x,level:Y,limitShowNum:A}),tooltip:D&&getPieTooltip({dataType:s,innerRows:o,limitShowNum:A,digit:E,metrics:m,dimension:d})}},ring=function(e,i,t,n){return pie$1(e,i,t,n,!0)},index=_extends({},Core,{name:"VeRing",data:function(){return this.chartHandler=ring,{}}});module.exports=index;
